var masterModule;(function(n){var t=function(t){$("#rightContent div:first").html(n.totalResult(t))};n.masterController=function(t,i){xSocketsModule.enabled?(xSocketsModule.ws=new jXSockets.WebSocket("ws://xsocketslive.cloudapp.net:10101/XSockets.Live.Realtime.API","XSockets.Live.Realtime.API",xSocketsModule.wsSettings),xSocketsModule.enableSink&&(xSocketsModule.ws.bind("open",function(){xSocketsModule.ws.trigger("Sink.Read",{model:"result-triss"})}),xSocketsModule.ws.bind("Sink.Read",function(n){$.each(n,function(n,i){t.remoteGames.push({guid:i.Key,maxWin:i.JSON.maxWin,totalGames:i.JSON.totalGames,totalSpent:i.JSON.totalSpent,totalWin:i.JSON.totalWin})}),app.localPublish("remote",t.remoteGames),$("#addgame").show()}),xSocketsModule.ws.bind("Sink.Create",function(n){t.guid=n.Key})),xSocketsModule.ws.bind("result",function(n){t.newRemoteResult(n)}),setTimeout(function(){$("#remoteResults").html("Cannot reach server, so no high-scores, sorry."),$("#addgame").show()},2e3)):($("#remoteResults").html("High-scores currently disabled, sorry."),$("#addgame").show()),app.localSubscribe("remote",function(n){var i="";n.sort(function(n,t){return n.totalSpent-n.totalWin-(t.totalSpent-t.totalWin)}),$.each(n,function(n,r){var f=n+1,u=f+". Result: "+(r.totalWin-r.totalSpent).toString()+" Spent: "+r.totalSpent.toString()+" Won: "+r.totalWin.toString()+" ("+Math.round(r.totalWin/r.totalSpent*100).toString+"%) max win:"+r.maxWin.toString();i+=r.guid==t.guid?"<p><strong>"+u+"<\/strong><\/p>":"<p>"+u+"<\/p>"}),$("#remoteResults").html(i)}),app.localSubscribe("ticketResult",function(){n.refreshTotalResult(t);var i=t.totalResult();xSocketsModule.enabled&&(xSocketsModule.enableSink&&(i.guid==null?xSocketsModule.ws.trigger("Sink.Create",{Type:"result-triss",JSON:i}):xSocketsModule.ws.trigger("Sink.Update",{Key:i.guid,JSON:i})),xSocketsModule.ws.trigger("result",i))}),$.each(t.games,function(n,t){t.render($("<div><\/div>").appendTo("#leftContent"))});i.$el.find("button").on("click",function(){var i=new gameModule.GameRenderer;i.render($("<div><\/div>").appendTo("#leftContent")),t.games.push(i),n.refreshTotalResult(t)})}})(masterModule||(masterModule={}))