var masterModule;(function(n){var t=function(){function n(){this.games=[],this.remoteGames=[]}return n.prototype.newRemoteResult=function(n){var i=this,t;this.remoteGames.length>0&&(t=!1,$.each(this.remoteGames,function(r,u){u.guid==n.guid&&(i.remoteGames[r]=n,t=!0)}),t||this.remoteGames.push(n),amplify.publish("remote",this.remoteGames))},n.prototype.totalResult=function(){var n=0,t=0,i=0;return $.each(this.games,function(r,u){n=n+u.model.spentMoney(),t=t+u.model.wonMoney,u.model.maxWin>i&&(i=u.model.maxWin)}),{guid:this.guid,totalSpent:n,totalWin:t,totalGames:this.games.length,maxWin:i}},n}();n.MasterModel=t;var f=new t,i=function(n){return H2(n)},r=function(n){var t=n.totalResult();return DIV(P("Total games: "+t.totalGames),P("Total spent: "+t.totalSpent),P("Max win: "+t.maxWin),P("Total win: "+t.totalWin))},e=function(n){return DIV(STYLE({type:"text/css"},CSS("#leftContent",{width:"50%",float:"left"}),CSS("#rightContent",{width:"50%",float:"right"}),CSS("p",{"margin-top":"0px","margin-bottom":"0px"})),DIV({id:"leftContent"},i("Games")),DIV({id:"rightContent"},i("Total Result"),DIV(r(n)),BUTTON({id:"addgame",style:"display:none;"},"Add game"),DIV({id:"fromServer"}),DIV({id:"remoteResults"},"Communicating with server...")))},u=function(n){$("#rightContent div:first").html(r(n))},o=function(n,t){app.ws.bind("Sink.Read",function(t){$.each(t,function(t,i){n.remoteGames.push({guid:i.Key,maxWin:i.JSON.maxWin,totalGames:i.JSON.totalGames,totalSpent:i.JSON.totalSpent,totalWin:i.JSON.totalWin})}),amplify.publish("remote",n.remoteGames)}),app.ws.bind("Sink.Create",function(t){n.guid=t.Key}),amplify.subscribe("remote",function(t){var i="";t.sort(function(n,t){return n.totalSpent-n.totalWin-(t.totalSpent-t.totalWin)}),$.each(t,function(t,r){var u=t+1;i+=r.guid==n.guid?"<p><strong>"+u+". Result: "+(r.totalWin-r.totalSpent).toString()+" Spent: "+r.totalSpent.toString()+" Won: "+r.totalWin.toString()+" max win:"+r.maxWin.toString()+"<\/strong><\/p>":"<p>"+u+". Result: "+(r.totalWin-r.totalSpent).toString()+" Spent: "+r.totalSpent.toString()+" Won: "+r.totalWin.toString()+" max win:"+r.maxWin.toString()+"<\/p>"}),$("#remoteResults").html(i)}),$(function(){return setTimeout(function(){app.ws.trigger("Sink.Read",{model:"result-triss"}),$("#addgame").show()},2e3)}),amplify.subscribe("ticketResult",function(){u(n);var t=n.totalResult();t.guid==null?app.ws.trigger("Sink.Create",{Type:"result-triss",JSON:t}):app.ws.trigger("Sink.Update",{Key:t.guid,JSON:t}),app.ws.trigger("result",t)}),app.ws.bind("result",function(t){n.newRemoteResult(t)}),$.each(n.games,function(n,t){t.render($("<div><\/div>").appendTo("#leftContent"))});t.$el.find("button").on("click",function(){var t=new gameModule.GameRenderer;t.render($("<div><\/div>").appendTo("#leftContent")),n.games.push(t),u(n)})};n.masterViewRenderer=new ViewRenderer(e,f,o)})(masterModule||(masterModule={}))